version: '3.8'  # –í–µ—Ä—Å–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Docker Compose

services:  # –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –∑–∞–ø—É—Å—Ç–∏—Ç—å

  zookeeper:  # Kafka —Ç—Ä–µ–±—É–µ—Ç Zookeeper –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –±—Ä–æ–∫–µ—Ä–æ–≤ (–ø–æ–∫–∞ —á—Ç–æ)
    image: confluentinc/cp-zookeeper:7.5.0  # –û–±—Ä–∞–∑ Zookeeper –æ—Ç Confluent
    container_name: zookeeper  # –Ø–≤–Ω–æ–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ —É–¥–æ–±–Ω–æ)
    ports:
      - "2181:2181"  # –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç Zookeeper (Kafka –±—É–¥–µ—Ç –∫ –Ω–µ–º—É –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è)
    environment:  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Zookeeper
      ZOOKEEPER_CLIENT_PORT: 2181  # –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ä—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
      ZOOKEEPER_TICK_TIME: 2000  # –¢–∞–π–º–∏–Ω–≥-—Å–µ—Å—Å–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä)

  kafka:  # –û—Å–Ω–æ–≤–Ω–æ–π –±—Ä–æ–∫–µ—Ä Kafka
    image: confluentinc/cp-kafka:7.5.0  # –û–±—Ä–∞–∑ Kafka –æ—Ç Confluent (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Zookeeper –≤—ã—à–µ)
    container_name: kafka  # –Ø–≤–Ω–æ–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Kafka
    ports:
      - "9092:9092"  # –ü–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–Ω–∞—Ä—É–∂–∏ (localhost)
      - "29092:29092"  # –ü–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    environment:  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
      KAFKA_BROKER_ID: 1  # ID –±—Ä–æ–∫–µ—Ä–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ (–µ—Å–ª–∏ –±—ã –∏—Ö –±—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181  # –ê–¥—Ä–µ—Å Zookeeper, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è Kafka
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,CONTAINER://kafka:29092
      # –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º Kafka "—Ä–µ–∫–ª–∞–º–∏—Ä—É–µ—Ç" —Å–µ–±—è –∫–ª–∏–µ–Ω—Ç–∞–º.
      # - PLAINTEXT://localhost:9092 ‚Äî –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∑–∞–ø—É—Å–∫–∞–µ–º—ã—Ö **–Ω–∞ —Ö–æ—Å—Ç–µ (–≤–Ω–µ Docker)**.
      # - CONTAINER://kafka:29092 ‚Äî –¥–ª—è **–¥—Ä—É–≥–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**, –æ–±—Ä–∞—â–∞—é—â–∏—Ö—Å—è –ø–æ –∏–º–µ–Ω–∏ kafka –≤–Ω—É—Ç—Ä–∏ docker-—Å–µ—Ç–∏.

      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTAINER://0.0.0.0:29092
      # –°–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö Kafka —Å–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
      # - 0.0.0.0 –æ–∑–Ω–∞—á–∞–µ—Ç "—Å–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö".
      # - –ù—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –æ–±–∞ ‚Äî –∏ –¥–ª—è localhost, –∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π docker-—Å–µ—Ç–∏.

      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTAINER:PLAINTEXT
      # –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ listener'–∞.
      # - –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç PLAINTEXT ‚Äî –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ TLS (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      # –≠—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Å–∫–æ–ª—å–∫–æ **–∫–æ–ø–∏–π (—Ä–µ–ø–ª–∏–∫)** Kafka –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è —Å–ª—É–∂–µ–±–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞ __consumer_offsets.
      # –≠—Ç–æ—Ç —Ç–æ–ø–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kafka, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –∫–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–∂–µ –±—ã–ª–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º–∏.
      #
      # –ó–Ω–∞—á–µ–Ω–∏–µ 1 –æ–∑–Ω–∞—á–∞–µ—Ç:
      # - –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ **–æ–¥–Ω—É –∫–æ–ø–∏—é** –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è).
      # - –≠—Ç–æ **–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**, –≥–¥–µ –æ–¥–∏–Ω Kafka-–±—Ä–æ–∫–µ—Ä –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞.
      #
      # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
      # - –û–±—ã—á–Ω–æ —Å—Ç–∞–≤—è—Ç `3` ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç (partition) –±—É–¥–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ 3-—Ö —Ä–∞–∑–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö.
      # - –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ –±—Ä–æ–∫–µ—Ä–æ–≤ –≤—ã–π–¥–µ—Ç –∏–∑ —Å—Ç—Ä–æ—è.
      #
      # ‚ö†Ô∏è –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ, —á–µ–º —Ä–µ–∞–ª—å–Ω–æ –ø–æ–¥–Ω—è—Ç–æ –±—Ä–æ–∫–µ—Ä–æ–≤ ‚Äî Kafka –Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å __consumer_offsets –∏ –∑–∞–≤–∞–ª–∏—Ç—Å—è.

    depends_on:
      - zookeeper  # Kafka –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ Zookeeper

  kafka-init:  # –ò–º—è —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∑–∞–¥–∞—á–µ–π –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ç–æ–ø–∏–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    image: confluentinc/cp-kafka:7.5.0  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –æ–±—Ä–∞–∑ Kafka, —Ç.–∫. –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Ç–∏–ª–∏—Ç—ã kafka-topics.sh –∏ cub
    container_name: kafka-init  # –Ø–≤–Ω–æ–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
    depends_on:
      - kafka  # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ kafka (–∏–Ω–∞—á–µ –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –≥–æ—Ç–æ–≤–∞)
    volumes:
      - ./create-topics.sh:/tmp/create-topics.sh  # –ü—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç create-topics.sh –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ /tmp
      # –¢–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä "—É–≤–∏–¥–∏—Ç" —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞ –∏ —Å–º–æ–∂–µ—Ç –µ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
    entrypoint: ["/bin/bash", "/tmp/create-topics.sh"]  # –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä—É—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ã–ø–æ–ª–Ω–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    # –≠—Ç–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π entrypoint'–∞ –æ–±—Ä–∞–∑–∞ Kafka

  kafka-ui: # üîç –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Kafka (https://github.com/provectus/kafka-ui)
    image: provectuslabs/kafka-ui  # üê≥ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ Kafka UI –æ—Ç Provectus
    ports:
      - "8088:8080"  # üåê –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 8080 (UI) –Ω–∞—Ä—É–∂—É –Ω–∞ 8088
    environment:
      KAFKA_CLUSTERS_0_NAME: local  # üìõ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞, –∫–∞–∫ –æ–Ω –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092  # üì° –ê–¥—Ä–µ—Å Kafka-–±—Ä–æ–∫–µ—Ä–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    depends_on:
      - kafka  # ‚è≥ –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Kafka, –∏–Ω–∞—á–µ –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
